DEFINE INSTRUMENT GISANS_test(
    double collimation = 20.0
)

DECLARE
%{
%}

INITIALIZE
%{
%}

TRACE

COMPONENT origin = Progress_bar()
  AT (0, 0, 0) RELATIVE ABSOLUTE

COMPONENT source =   Source_simple(xwidth=0.05, yheight=0.05, dist=20.0,
                    focus_xw=0.01, focus_yh=0.001, lambda0=10.0, dlambda=0.1)
  AT (0, 0, 0) RELATIVE origin

COMPONENT total_in = L_monitor(filename="total_in.L", xmin=-0.1, xmax=0.1, ymin=-0.1, ymax=0.1, nL=20, Lmin=2, Lmax=22)
AT (0, 0, collimation-0.1) RELATIVE origin

SPLIT 123 COMPONENT test = BAclient(splits=123, ang_range=1.5)
AT (0, 0, collimation) RELATIVE origin
ROTATED (89.85, 0, 0) RELATIVE origin

COMPONENT total_out = L_monitor(filename="total_out.L", xmin=-0.1, xmax=0.1, ymin=-0.1, ymax=0.1, nL=20, Lmin=2, Lmax=22)
AT (0, 0, collimation+0.1) RELATIVE origin

COMPONENT detector = PSD_monitor(
    xmin=-0.5, xmax=0.5,
    ymin=-0.5, ymax=0.5,
    nx=128, ny=128,
    filename="detector.psd")
AT (0, 0, 40) RELATIVE origin

END